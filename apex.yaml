type: custom:apexcharts-card
experimental:
  hidden_by_default: true
apex_config:
  chart:
    height: auto
header:
  show: true
  show_states: true
  colorize_states: true
graph_span: 5d
span:
  start: minute
  offset: +0h
all_series_config:
  stroke_width: 2
yaxis:
  - id: power
    min: -35
    max: 35
    decimals: 0
    apex_config:
      title:
        text: Power (kW)
      forceNiceScale: true
      tick_amount: 4
  - id: soc
    min: -100
    max: 100
    decimals: 0
    show: false
    apex_config:
      title:
        text: Battery State of Charge
      opposite: true
      forceNiceScale: true
      tick_amount: 4
  - id: price
    min: -1
    max: 1
    decimals: 2
    apex_config:
      title:
        text: Price ($)
      opposite: true
      forceNiceScale: true
      tick_amount: 4
series:
  - entity: sensor.optimizer_cost
    unit: $
    invert: true
    float_precision: 0
    name: Cost
    show:
      legend_value: false
      in_chart: false
    yaxis_id: power
  - entity: number.solar_forecast
    curve: straight
    type: area
    color: "#fc0"
    extend_to: false
    show:
      in_header: false
      legend_value: false
    data_generator: |
      return entity.attributes.forecast
        .map(entry => [new Date(entry.time), entry.value])
    yaxis_id: power
  - entity: sensor.load_power
    curve: smooth
    type: area
    color: "#a0f"
    extend_to: false
    show:
      in_header: false
      legend_value: false
    data_generator: |
      return entity.attributes.forecast
        .map(entry => [new Date(entry.time), -entry.value])
    yaxis_id: power
  - entity: sensor.grid_active_power
    curve: stepline
    color: "#1af"
    type: area
    extend_to: false
    show:
      in_header: false
      legend_value: false
    data_generator: |
      return entity.attributes.forecast
        .map(entry => [new Date(entry.time), -entry.value])
    yaxis_id: power
  - entity: sensor.battery_active_power
    curve: stepline
    color: "#00bb84"
    extend_to: false
    show:
      in_header: false
      legend_value: false
    stroke_width: 1
    type: area
    data_generator: |
      return entity.attributes.forecast
        .map(entry => [new Date(entry.time), -entry.value])
    yaxis_id: power
  - entity: sensor.battery_state_of_charge
    type: line
    curve: straight
    stroke_width: 4
    stroke_dash: 4
    color: "#00cc00"
    extend_to: false
    show:
      in_header: false
      legend_value: false
    data_generator: |
      return entity.attributes.forecast
        .map(entry => [new Date(entry.time), entry.value])
    yaxis_id: soc
  - entity: number.grid_import_price
    stroke_width: 3
    curve: stepline
    show:
      in_header: raw
    color: "#4400ff"
    name: Buy Price
    data_generator: |
      return entity.attributes.forecast
        .map(entry => [new Date(entry.time), entry.value])
    yaxis_id: price
  - entity: number.grid_export_price
    stroke_width: 3
    curve: stepline
    show:
      in_header: raw
    color: "#ff00ff"
    name: Sell Price
    data_generator: |
      return entity.attributes.forecast
        .map(entry => [new Date(entry.time), entry.value])
    yaxis_id: price
view_layout:
  position: main
